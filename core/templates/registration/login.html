{% extends 'core/base.html' %}
{% load i18n %}
{% block title %}{% trans "Login | Dance Portal" %}{% endblock %}

{% block extra_head %}
<style>
  :root { --coral:#d76f54; }

  .login-wrap{
    max-width: 460px;
    margin: 2.25rem auto 2.75rem;
  }
  .login-card{
    border: 1px solid #f0e3df;
    border-radius: 16px;
    box-shadow: 0 14px 32px rgba(0,0,0,.08);
    overflow: hidden;
    background: #fff;
  }
  .login-header{
    background: linear-gradient(180deg, #fff7f4 0%, #ffece7 100%);
    border-bottom: 1px solid #f1ded9;
    padding: 1.15rem 1.25rem;
  }
  .login-header h2{
    font-weight: 800;
    font-size: 1.55rem;
    margin: 0;
    color: #2b2b2b;
  }
  .form-icon{
    width: 44px;
    display:flex; align-items:center; justify-content:center;
    color:#8a8a8a;
  }
  .form-control{
    padding: .65rem .9rem;
    border-radius: 10px;
  }
  .input-group>.form-control{ border-top-left-radius: 0; border-bottom-left-radius: 0; }
  .showpwd-btn{
    border: 1px solid #ced4da;
    border-left: 0;
    background:#fff;
    border-top-right-radius: 10px;
    border-bottom-right-radius: 10px;
  }
  .btn-coral{
    background-color: var(--coral);
    border-color: var(--coral);
    color:#fff;
    font-weight: 600;
    border-radius: 999px;
    padding: .65rem 1.25rem;
  }
  .btn-coral:hover{ background:#c45f45; border-color:#c45f45; color:#fff; }
  .aux-links a{ color: var(--coral); text-decoration: none; }
  .aux-links a:hover{ text-decoration: underline; }
</style>
{% endblock %}

{% block content %}
<div class="login-wrap">

  <div class="login-card">
    <div class="login-header">
      <h2>{% trans "Login" %}</h2>
    </div>

    <div class="p-4 p-md-4">

      {% if form.non_field_errors %}
        <div class="alert alert-danger mb-3">
          {% for error in form.non_field_errors %}
            {{ error }}{% if not forloop.last %}<br>{% endif %}
          {% endfor %}
        </div>
      {% endif %}

      <form method="post" novalidate>
        {% csrf_token %}
        {% if request.GET.next %}
          <input type="hidden" name="next" value="{{ request.GET.next }}">
        {% endif %}

        <!-- Username / Email -->
        <div class="mb-3">
          <label for="id_username" class="form-label fw-semibold">{% trans "Username / Email" %}</label>
          <div class="input-group">
            <span class="input-group-text form-icon"><i class="bi bi-person"></i></span>
            <input type="text" name="username" id="id_username" class="form-control" required autocomplete="username">
          </div>
          {% if form.username.errors %}
            <div class="text-danger small mt-1">{{ form.username.errors.0 }}</div>
          {% endif %}
        </div>

        <!-- Password -->
        <div class="mb-2">
          <label for="id_password" class="form-label fw-semibold">{% trans "Password" %}</label>
          <div class="input-group">
            <span class="input-group-text form-icon"><i class="bi bi-lock"></i></span>
            <input type="password" name="password" id="id_password" class="form-control" required autocomplete="current-password">
            <button class="showpwd-btn px-3" type="button" id="togglePwd" aria-label="{% trans 'Show password' %}">
              <i class="bi bi-eye"></i>
            </button>
          </div>
          {% if form.password.errors %}
            <div class="text-danger small mt-1">{{ form.password.errors.0 }}</div>
          {% endif %}
        </div>

        <!-- Remember + Forgot -->
        <div class="d-flex justify-content-between align-items-center mb-3 aux-links">
          <div class="form-check">
            <input class="form-check-input" type="checkbox" value="on" id="remember_me" name="remember_me">
            <label class="form-check-label" for="remember_me">{% trans "Remember me" %}</label>
          </div>
          <a href="{% url 'password_reset' %}">{% trans "Forgot your password?" %}</a>
        </div>

        <div class="d-grid">
          <button type="submit" class="btn btn-coral">
            <i class="bi bi-box-arrow-in-right me-1"></i> {% trans "Login" %}
          </button>
        </div>
      </form>

      <div class="text-center mt-3 aux-links">
        <span class="text-muted">{% trans "New here?" %}</span>
        <a href="{% url 'register_club' %}" class="ms-1">{% trans "Create a club account" %}</a>
      </div>

    </div>
  </div>
</div>
{% endblock %}

{% block extra_scripts %}
<script>
  (function () {
    const pwd = document.getElementById('id_password');
    const btn = document.getElementById('togglePwd');
    if (!pwd || !btn) return;
    btn.addEventListener('click', function(){
      const isText = pwd.getAttribute('type') === 'text';
      pwd.setAttribute('type', isText ? 'password' : 'text');
      this.innerHTML = isText ? '<i class="bi bi-eye"></i>' : '<i class="bi bi-eye-slash"></i>';
      this.setAttribute('aria-label', isText ? '{{ _("Show password") }}' : '{{ _("Hide password") }}');
    });
  })();
</script>
{% endblock %}
