{% extends 'core/base.html' %}
{% load i18n %}
{% block title %}{% trans "Events" %}{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-3">
  <h2 class="mb-0">{% trans "Upcoming Events" %}</h2>
  {% if user.is_superuser %}
    <a href="{% url 'create_event' %}" class="btn btn-coral-outline">{% trans "Create Event" %}</a>
  {% endif %}
</div>

<div class="row g-4">
  {% for event in events %}
    <div class="col-12 col-md-6 col-lg-4">
      <div class="card h-100 border-0 shadow-sm overflow-hidden">

        {# Poster #}
        <div class="position-relative" style="height: 200px; overflow: hidden; border-radius: .5rem .5rem 0 0;">
        {% if event.notice_image %}
            <img src="{{ event.notice_image.url }}" class="w-100 h-100 object-fit-cover" alt="{{ event.name }}">
        {% else %}
            <div class="w-100 h-100 bg-light d-flex align-items-center justify-content-center">
            <span class="text-muted">{% trans "No poster" %}</span>
            </div>
        {% endif %}
        <div class="card-img-overlay p-3 gradient-overlay"></div>
        <div class="card-img-overlay d-flex flex-column justify-content-end p-3">
            <h5 class="text-white fw-semibold mb-1">{{ event.name }}</h5>
            <div class="small text-white-50">
            <span>üìç {{ event.city }} ‚Äî {{ event.location }}</span>
            <span class="ms-2">üìÖ {{ event.date }}</span>
            {% if event.start_time %}
                <span class="ms-2">üïí {{ event.start_time }}</span>
            {% endif %}
            </div>
        </div>
        </div>

        {# Status badges #}
        <div class="card-body" style="
  background: linear-gradient(180deg, #fff7f4 0%, #ffeae3 100%);
  border-top: 1px solid #f0d2ca;
">  {# soft coral tint #}
        <div class="d-flex flex-wrap gap-2 mb-3">
          <span class="badge status-badge {% if event.is_published %}status-green{% else %}status-red{% endif %}">
            {% trans "Event Published" %}
          </span>

          <span class="badge status-badge {% if event.start_list_published %}status-green{% else %}status-red{% endif %}">
            {% trans "Start List Published" %}
          </span>

          {% if user.is_superuser %}
            <span class="badge status-badge {% if event.has_judges %}status-green{% else %}status-red{% endif %}">
              {% trans "Judges" %}
            </span>
          {% endif %}

          <span class="badge status-badge {% if event.results_published %}status-green{% else %}status-red{% endif %}">
            {% trans "Results Published" %}
          </span>
        </div>

        <hr>

        <div class="d-flex align-items-center gap-2 flex-wrap">
          {% if user.is_superuser %}
            <a class="btn btn-sm btn-coral" href="{% url 'edit_event' event.id %}">{% trans "Edit" %}</a>
            <a class="btn btn-sm btn-coral" href="{% url 'manage_start_list' event.id %}">{% trans "Start List" %}</a>

            <div class="dropdown ms-auto">
              <button class="btn btn-sm btn-coral dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" style="color:#d76f54">
                {% trans "Actions" %}
              </button>
              <ul class="dropdown-menu dropdown-menu-end shadow-sm">
                <li><a class="dropdown-item" href="{% url 'register_dancer' event.id %}">{% trans "Register Dancers" %}</a></li>
                <li><a class="dropdown-item" href="{% url 'list_event_participants' event.id %}">{% trans "View Registered" %}</a></li>
                <li><a class="dropdown-item" href="{% url 'manage_styles' event.id %}">{% trans "Manage Style Categories" %}</a></li>
                <li><a class="dropdown-item" href="{% url 'event_music' event.id %}">{% trans "Event Music" %}</a></li>
                <li><a class="dropdown-item" href="{% url 'manage_judges' event.id %}">{% trans "Judges" %}</a></li>
                <li><a class="dropdown-item" href="{% url 'event_awards' event.id %}">{% trans "Awards" %}</a></li>
                <li><a class="dropdown-item" href="{% url 'notify_clubs' event.id %}">{% trans "Notify Clubs" %}</a></li>
              </ul>
            </div>

          {% else %}
            {% if event.is_published %}
              <a class="btn btn-sm btn-coral" href="{% url 'register_dancer' event.id %}">{% trans "Register" %}</a>
              <a class="btn btn-sm btn-coral" href="{% url 'list_event_participants' event.id %}">{% trans "View Registered" %}</a>
              {% if event.start_list_published %}
                <a class="btn btn-sm btn-coral" href="{% url 'start_list' event.id %}">{% trans "Start List" %}</a>
              {% endif %}
              {% if event.results_published %}
                <a class="btn btn-sm btn-coral" href="{% url 'event_awards' event.id %}">{% trans "Results" %}</a>
              {% endif %}
            {% else %}
              <span class="text-muted fst-italic small">{% trans "Event published soon ‚Äì no actions available" %}</span>
            {% endif %}
          {% endif %}
        </div>
      </div>

      </div>
    </div>
  {% empty %}
    <p class="text-muted">{% trans "No events yet." %}</p>
  {% endfor %}
</div>
{% endblock %}

{% block extra_head %}
<style>
  /* object-fit helper for posters (Bootstrap doesn't ship one) */
  .object-fit-cover { object-fit: cover; }

  /* dark gradient so white text on poster is readable */
  .gradient-overlay {
    background: linear-gradient(to top, rgba(0,0,0,.55), rgba(0,0,0,.05));
  }

  /* make quick-action buttons match your coral theme on hover */
  .btn-outline-secondary:hover {
    background: #d76f54;
    border-color: #d76f54;
    color: #fff;
  }

  /* --- Dropdown coral theme --- */
  .dropdown-menu {
    border: none;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    z-index: 1055;
  }

  .dropdown-menu .dropdown-item {
    padding: 0.5rem 1rem;
    color: #d76f54;
    font-weight: 500;
    transition: background-color 0.2s ease, color 0.2s ease;
  }

  .dropdown-menu .dropdown-item:hover,
  .dropdown-menu .dropdown-item:focus {
    background-color: #d76f54;
    color: #fff;
  }

  .dropdown-toggle {
    border-color: #d76f54 !important;
    color: #d76f54 !important;
  }

  .dropdown-toggle:hover,
  .dropdown-toggle:focus {
    background-color: #d76f54 !important;
    color: #fff !important;
  }
  
    .card, .card-body, .card-img-overlay {
    overflow: visible !important;
    }
    
    .card-body {
      background: linear-gradient(180deg, #fff7f4 0%, #ffeae3 100%);
      border-top: 2px solid rgba(215,111,84,0.2);
      box-shadow: inset 0 3px 5px rgba(0,0,0,0.05);
      border-radius: 0 0 .5rem .5rem;
    }

    .card-body:hover {
      background-color: #ffeae3; /* slightly deeper coral tint on hover */
    }
    
    status-badge {
  border: 1px solid rgba(0,0,0,0.08);
  box-shadow: 0 1px 3px rgba(0,0,0,0.08);
  font-weight: 500;
  padding: 0.35rem 0.65rem;
  border-radius: 0.5rem;
}

/* Published colors */
.status-green { background: #28a745; color: #fff; }   /* event */
.status-red { background: #d31d1d; color: #fff; }   /* start list */
.status-blue  { background: #0b5ed7; color: #fff; }   /* judges */
.status-gold  { background: #ffc107; color: #333; }   /* results */

/* Unpublished (grey) */
.status-grey  { background: #adb5bd; color: #fff; }

</style>
{% endblock %}

{% block extra_js_bottom %}
<script>
  // (Optional) If you later reintroduce a carousel of buttons, Bootstrap already provides scroll snapping.
  // For now, dropdown covers all actions so no JS is required.
</script>
{% endblock %}

