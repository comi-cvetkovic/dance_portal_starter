{% extends 'core/base.html' %}
{% load i18n %}
{% block title %}Start List | {{ event.name }}{% endblock %}

{% block content %}
<h2>Start List for {{ event.name }} â€“ {{ event.city }} ({{ event.date }})</h2>

{% if show_entries %}
<div class="table-wrapper">
<table class="start-group" id="group-container" style="width: 100%; border-collapse: collapse; margin-bottom: 2em;">
    <thead>
        <tr>
            <th>#</th>
            <th>{% trans "Dancer(s)" %}</th>
            <th>{% trans "Choreographer" %}</th>
            <th>{% trans "Choreography" %}</th>
            <th>{% trans "Club" %}</th>
        </tr>
    </thead>

    {% for group_key, group_entries in grouped_entries.items %}
    <tbody class="group-wrapper" data-group="{{ group_key|join:'|' }}">
        <tr class="group-header {% if group_key|join:'|' == highlight_key %}highlighted-group{% endif %}">
            <td colspan="6">
                <strong>
                    {% if event.results_published %}
                    <a href="{% url 'category_results' event.id group_key|join:'|' %}" style="text-decoration: none;">
                        {{ group_key.0 }} â€“ {{ group_key.1 }} â€“ {{ group_key.2 }} â€“ {{ group_key.3 }}
                    </a>
                    {% else %}
                    {{ group_key.0 }} â€“ {{ group_key.1 }} â€“ {{ group_key.2 }} â€“ {{ group_key.3 }}
                    {% endif %}
                </strong>
            </td>
        </tr>

        {% for entry in group_entries %}
        <tr>
            <td>
                {{ entry.global_row_number }}
                {% if entry.start_time %}
                <br><span class="start-time">{{ entry.start_time }}</span>
                {% endif %}
            </td>
            <td>
                {% if entry.dancers|stringformat:"s" == entry.dancers %}
                {{ entry.dancers }}
                {% else %}
                {% for dancer in entry.dancers %}
                {{ dancer.first_name }} {{ dancer.last_name }}{% if not forloop.last %}, {% endif %}
                {% endfor %}
                {% endif %}
            </td>
            <td>{{ entry.choreographer }}</td>
            <td>{{ entry.choreography_name }}</td>
            <td>{{ entry.club_name }}</td>
        </tr>
        {% endfor %}
    </tbody>
    {% endfor %}
</table>
</div>
{% else %}
<p>{% trans "The start list has not been published yet" %}.</p>
{% endif %}
{% endblock %}

{% block extra_styles %}
<style>
.table-wrapper { overflow-x: auto; }
.start-group th,
.start-group td {
    white-space: normal;
    word-break: break-word;
    padding: .6rem .75rem;
}
.start-group thead th {
    background: #f8f9fa;
    font-weight: 600;
    white-space: nowrap;
}
.start-group .start-time {
    font-size: 0.85em;
    color: gray;
}

/* âœ… Highlight style */
.highlighted-group {
    background-color: #fff7d6 !important;
    border-left: 6px solid #ff9800;
}

@media (max-width: 1024px) {
    .start-group th,
    .start-group td {
        font-size: 0.8rem;
        padding: 3px 4px;
        text-align: left;
    }
}
</style>
{% endblock %}

{% block extra_scripts %}
<script>
    // ðŸ”„ Auto refresh every 10s
    setInterval(() => location.reload(), 10000);

    // ðŸŽ¯ Scroll to highlighted category
    document.addEventListener("DOMContentLoaded", () => {
        const highlighted = document.querySelector('.highlighted-group');
        if (highlighted) {
            highlighted.scrollIntoView({behavior: 'smooth', block: 'center'});
        }
    });
</script>
{% endblock %}

