{% extends 'core/base.html' %}
{% load i18n %}
{% block title %}Start List | {{ event.name }}{% endblock %}

{% block content %}
<h2>Start List for {{ event.name }} – {{ event.city }} ({{ event.date }})</h2>

{% if show_entries %}
<div class="table-wrapper">
<table class="start-group" id="group-container" style="width: 100%; border-collapse: collapse; margin-bottom: 2em;">
    <thead>
        <tr>
            <th>#</th>
            <th>{% trans "Dancer(s)" %}</th>
            <th>{% trans "Choreographer" %}</th>
            <th>{% trans "Choreography" %}</th>
            <th>{% trans "Club" %}</th>
        </tr>
    </thead>

    {% for group_key, group_entries in grouped_entries.items %}
    <tbody class="group-wrapper" data-group="{{ group_key|join:'|' }}">
        <tr class="group-header {% if group_key|join:'|' == highlight_key %}highlighted-group{% endif %}">
            <td colspan="6">
                <strong>
                    {% if event.results_published %}
                    <a href="{% url 'category_results' event.id group_key|join:'|' %}" style="text-decoration: none;">
                        {{ group_key.0 }} – {{ group_key.1 }} – {{ group_key.2 }} – {{ group_key.3 }}
                    </a>
                    {% else %}
                    {{ group_key.0 }} – {{ group_key.1 }} – {{ group_key.2 }} – {{ group_key.3 }}
                    {% endif %}
                </strong>
            </td>
        </tr>

        {% for entry in group_entries %}
        <tr>
            <td>
                {{ entry.global_row_number }}
                {% if entry.start_time %}
                <br><span class="start-time">{{ entry.start_time }}</span>
                {% endif %}
            </td>
            <td>
                {% if entry.dancers|stringformat:"s" == entry.dancers %}
                {{ entry.dancers }}
                {% else %}
                {% for dancer in entry.dancers %}
                {{ dancer.first_name }} {{ dancer.last_name }}{% if not forloop.last %}, {% endif %}
                {% endfor %}
                {% endif %}
            </td>
            <td>{{ entry.choreographer }}</td>
            <td>{{ entry.choreography_name }}</td>
            <td>{{ entry.club_name }}</td>
        </tr>
        {% endfor %}
    </tbody>
    {% endfor %}
</table>
</div>
{% else %}
<p>{% trans "The start list has not been published yet" %}.</p>
{% endif %}
{% endblock %}

{% block extra_styles %}
<style>
.table-wrapper {
    overflow-x: auto;
}
.start-group th, .start-group td {
    white-space: normal;   /* allow wrapping */
    word-break: break-word;
    padding: .6rem .75rem;
}
.start-group .start-time {
    font-size: 0.85em; color: gray;
}
@media (max-width: 1024px) {
    /* Smaller, wrapped table */
    .start-group th,
    .start-group td {
        font-size: 0.8rem;
        white-space: normal;
        word-break: break-word;
        padding: 3px 4px;
        text-align: left;
    }

    .start-group {
        width: 100%;
        border-collapse: collapse;
        table-layout: auto;
    }

    /* Toolbar styling */
    #sticky-toolbar {
        position: relative;         /* place it in flow, above table */
        top: auto;
        right: auto;
        left: auto;
        margin: 0 0 0.5rem 0;       /* small space below */
        display: flex;
        justify-content: center;
        flex-wrap: wrap;            /* stack if needed */
        gap: 6px;
        width: 100%;
        background: transparent;    /* no big white box */
        box-shadow: none;
        padding: 0;
    }

    #sticky-toolbar button {
        font-size: 0.8rem;
        padding: 4px 8px;
        flex: 0 1 auto;
    }
}

</style>
{% endblock %}

{% block extra_scripts %}
{% if is_admin %}
<script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
<script>
    // same drag/drop + publish logic you already have in manage_start_list
</script>
{% endif %}
{% endblock %}

