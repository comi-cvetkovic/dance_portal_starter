{% extends 'core/base.html' %}
{% load i18n %}
{% block title %}{% trans "Dashboard" %}{% endblock %}

{% block content %}

{% if user.is_superuser %}
  <!-- ===================== ADMIN DASHBOARD ===================== -->
  <div class="dash-hero">
    <div>
      <h2 class="heading-dark">{% trans "Admin Dashboard" %}</h2>
      <p class="muted">{% trans "Manage clubs and events from a single place." %}</p>
    </div>
    <div class="hero-actions">
      <a href="{% url 'event_list' %}" class="btn btn-green">{% trans "Manage Events" %}</a>
      <a href="{% url 'pending_club_requests' %}" class="btn btn-default">{% trans "Pending Club Requests" %}</a>
    </div>
  </div>

  <div class="grid-2">
    <div class="card" style="grid-column: 1 / -1;">
      <h3 class="card-title">üè´ {% trans "All Clubs" %} <span class="badge">{{ clubs|length }}</span></h3>
      {% if clubs %}
        <div class="table-wrap">
          <table class="nice-table">
            <thead>
              <tr>
                <th>{% trans "Club" %}</th>
                <th>{% trans "Representative" %}</th>
                <th class="hide-mobile">{% trans "Country" %}</th>
                <th class="hide-mobile">{% trans "City" %}</th>
                <th class="hide-mobile">{% trans "Email" %}</th>
                <th class="hide-mobile">{% trans "Phone" %}</th>
                <th>{% trans "Status" %}</th>
                <th>{% trans "Actions" %}</th>
              </tr>
            </thead>
            <tbody>
            {% for c in clubs %}
              <tr>
                <td>{{ c.club_name }}</td>
                <td>{{ c.representative_name }}</td>
                <td class="hide-mobile">{{ c.country.name }}</td>
                <td class="hide-mobile">{{ c.city }}</td>
                <td class="hide-mobile email-col">{{ c.user.email }}</td>
                <td class="hide-mobile">{{ c.phone_number }}</td>
                <td>
                  {% if c.confirmed %}
                    <span class="status-dot ok"></span> {% trans "Confirmed" %}
                  {% else %}
                    <span class="status-dot warn"></span> {% trans "Pending" %}
                  {% endif %}
                </td>
                <td>
                  <div class="btn-row">
                    <a class="btn btn-default btn-sm" href="{% url 'admin_list_dancers' c.id %}">{% trans "Dancers" %}</a>
                    <a href="{% url 'edit_club' c.id %}" class="btn btn-edit">{% trans "Edit" %}</a>
                    <a class="btn btn-delete btn-sm"
                       href="{% url 'delete_club' c.id %}"
                       onclick="return confirm('{% blocktrans %}Delete this club? This cannot be undone.{% endblocktrans %}');">
                       {% trans "Delete" %}
                    </a>
                  </div>
                </td>
              </tr>
            {% endfor %}
            </tbody>
          </table>
        </div>
      {% else %}
        <p class="muted">{% trans "No clubs yet." %}</p>
      {% endif %}
    </div>
  </div>

{% else %}
  <!-- ===================== CLUB DASHBOARD ===================== -->
  <div class="dash-hero">
    <div>
      <h2 class="heading-dark">{% trans "Welcome" %}, {{ club.representative_name|default:user.get_username }}</h2>
      <p class="muted">{% trans "Here‚Äôs a quick overview of your club and useful shortcuts." %}</p>
    </div>
    <div class="hero-actions">
      <a href="{% url 'edit_own_club' %}" class="btn btn-edit">{% trans "Edit Club Details" %}</a>
      <a href="{% url 'event_list' %}" class="btn btn-green">{% trans "Browse Events" %}</a>
    </div>
  </div>

  <div class="grid-3">
    <div class="card">
      <h3 class="card-title">üè´ {% trans "Club Overview" %}</h3>
      <ul class="kv">
        <li><strong>{% trans "Club Name" %}:</strong> {{ club.club_name }}</li>
        <li><strong>{% trans "Country" %}:</strong> {{ club.country.name }}</li>
        <li><strong>{% trans "City" %}:</strong> {{ club.city }}</li>
        <li><strong>{% trans "Email" %}:</strong> {{ club.user.email }}</li>
        <li><strong>{% trans "Phone" %}:</strong> {{ club.phone_number }}</li>
        <li><strong>{% trans "Dancers" %}:</strong> {{ club.dancers.count }}</li>
      </ul>
    </div>

    <div class="card">
      <h3 class="card-title">üëØ {% trans "Dancers" %}</h3>
      <p class="muted">{% trans "Add or manage the dancers in your club." %}</p>
      <div class="btn-row">
        <a href="{% url 'list_dancers' %}" class="btn btn-default">{% trans "Manage Dancers" %}</a>
        <a href="{% url 'add_dancer' %}" class="btn btn-green">{% trans "Add Dancer" %}</a>
      </div>
    </div>

    <div class="card">
      <h3 class="card-title">üìÖ {% trans "Events & Registration" %}</h3>
      <p class="muted">{% trans "Find events, register dancers, and view start lists." %}</p>
      <div class="btn-row">
        <a href="{% url 'event_list' %}" class="btn btn-default">{% trans "All Events" %}</a>
      </div>
    </div>
  </div>
{% endif %}

{% endblock %}

{% block extra_styles %}
<style>
  .dash-hero {
    background:#f8f9fa; border-radius:14px; padding:18px 22px; margin-bottom:18px;
    display:flex; align-items:center; justify-content:space-between; gap:16px;
  }
  .hero-actions .btn{ margin-left:8px; }

  .grid-2{ display:grid; grid-template-columns:1fr 1fr; gap:16px; }
  .grid-3{ display:grid; grid-template-columns:repeat(3, 1fr); gap:16px; }
  @media (max-width: 900px){ .grid-2,.grid-3{ grid-template-columns:1fr; } }

  .card{ background:#fff; border:1px solid #e8e8e8; border-radius:14px; padding:18px;
    box-shadow:0 2px 8px rgba(0,0,0,.04); }
  .card-title{ margin:0 0 .6rem 0; font-size:1.1rem; display:flex; align-items:center; gap:.5rem; }

  .muted{ color:#666; }
  .kv{ margin:0; padding-left:1rem; }
  .kv li{ margin:.35rem 0; }

  .btn-row .btn{ margin-right:8px; margin-bottom:8px; }
  .badge{ display:inline-block; background:#eef2ff; border-radius:10px;
    padding:2px 8px; font-size:.85rem; margin-left:.4rem; }

  .table-wrap{ overflow-x: auto; }
  .nice-table{ width:100%; border-collapse: collapse; }
  .nice-table th, .nice-table td{ padding:10px 12px; border-bottom:1px solid #eee; vertical-align: middle; }
  .nice-table thead th{ background:#fafafa; text-align:left; font-weight:600; }

  /* Email column: only break at safe points */
  .nice-table td.email-col {
    white-space: normal;
    word-break: keep-all;
    overflow-wrap: anywhere; /* breaks at @ or . */
  }

  /* Keep action buttons aligned in one row */
  .btn-row {
    display: flex;
    flex-wrap: nowrap; /* don‚Äôt wrap buttons */
    gap: 6px;
    justify-content: flex-start;
  }
  .nice-table td .btn {
    min-width: 65px;
    height: 26px;
    font-size: 0.7rem;
    text-align: center;
    padding: 2px 6px;
    white-space: nowrap;
    line-height: 1.2;
  }

  .status-dot{ width:10px; height:10px; display:inline-block; border-radius:50%; margin-right:6px; vertical-align:middle; }
  .status-dot.ok{ background:#28a745; }
  .status-dot.warn{ background:#ffc107; }

  /* Responsive tweaks */
  @media (max-width: 1024px) {
    .nice-table td .btn { min-width: 55px; font-size: 0.65rem; padding: 2px 4px; }
    .hide-mobile { display: none; }
  }
</style>
{% endblock %}
