
{% load static i18n %}
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>{% block title %}Dance Portal{% endblock %}</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=0.5, maximum-scale=5, user-scalable=yes">

  <!-- Bootstrap 5 CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
        rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
        crossorigin="anonymous">
  <!-- Bootstrap Icons -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">

  <!-- Custom CSS -->
  <link rel="stylesheet" href="{% static 'css/site.css' %}">

  <!-- Favicons -->
  <link rel="icon" type="image/png" sizes="32x32" href="{% static 'icons/favicon-32x32.png' %}?v=7">
  <link rel="icon" type="image/png" sizes="16x16" href="{% static 'icons/favicon-16x16.png' %}?v=7">
  <link rel="shortcut icon" href="{% static 'icons/favicon.ico' %}?v=7">
  <link rel="apple-touch-icon" sizes="180x180" href="{% static 'icons/apple-touch-icon.png' %}?v=7">
  <link rel="manifest" href="{% static 'icons/site.webmanifest' %}">
  <meta name="theme-color" content="#d76f54">

  {% block head_css %}{% endblock %}
  {% block extra_head %}{% endblock %}

  <!-- ðŸŒº Global Coral Button Theme -->
  <style>
    /* Global coral button theme override */
    :root{
    --brand-coral:#d76f54;
    --brand-coral-d1:#c45f45;
    --brand-coral-d2:#b34f3a;
    --brand-coral-tint:#fff2ee;
  }

  /* Filled coral */
  .btn-coral,
  button.btn-coral,
  input[type="submit"].btn-coral,
  a.btn-coral{
    background: var(--brand-coral);
    border-color: var(--brand-coral);
    color:#fff !important;
    box-shadow: 0 2px 4px rgba(0,0,0,.1);
    transition: transform .2s ease, box-shadow .2s ease, background .2s ease, border-color .2s ease;
  }
  .btn-coral:hover,
  .btn-coral:focus{
    background: var(--brand-coral-d1);
    border-color: var(--brand-coral-d1);
    color:#fff !important;
    transform: translateY(-1px);
    box-shadow: 0 4px 6px rgba(0,0,0,.15);
  }
  .btn-coral:active{
    background: var(--brand-coral-d2);
    border-color: var(--brand-coral-d2);
    transform: translateY(0);
    box-shadow:none;
  }

  /* Outline coral */
  .btn-coral-outline,
  button.btn-coral-outline,
  a.btn-coral-outline{
    background:#fff;
    border-color: var(--brand-coral);
    color: var(--brand-coral) !important;
    transition: transform .2s ease, box-shadow .2s ease, background .2s ease, border-color .2s ease, color .2s ease;
  }
  .btn-coral-outline:hover,
  .btn-coral-outline:focus{
    background: var(--brand-coral-tint);
    border-color: var(--brand-coral-d1);
    color: var(--brand-coral-d1) !important;
    transform: translateY(-1px);
    box-shadow: 0 2px 4px rgba(0,0,0,.08);
  }
  .btn-coral-outline:active{
    background:#fff;
    border-color: var(--brand-coral-d2);
    color: var(--brand-coral-d2) !important;
    transform: translateY(0);
    box-shadow:none;
  }

  /* Disabled states */
  .btn-coral:disabled,
  .btn-coral-outline:disabled{
    opacity:.65;
    transform:none;
    box-shadow:none;
  }
  /* Comfy inputs everywhere (even when widgets don't have .form-control) */
  input[type="text"],
  input[type="number"],
  input[type="email"],
  input[type="tel"],
  input[type="date"],
  input[type="time"],
  input[type="file"],
  select,
  textarea,
  .form-control {
    padding: .65rem .95rem !important;   /* <- more left/right space */
    border-radius: 10px !important;
  }

  /* Card breathing room */
  .dp-card .card-header { padding: .9rem 1.25rem !important; }
  .dp-card .card-body   { padding: 1.25rem 1.5rem !important; }

  /* List items (e.g., existing ceremonies) */
  .list-group-item { padding: .95rem 1.25rem !important; }
  </style>
</head>

<body class="d-flex flex-column min-vh-100">

  <!-- Background -->
  <style>
    body {
      background-color: #f8d9ce;
      margin: 0;
      padding-bottom: 60px; /* keeps content above footer */
    }
    body::before {
      content: "";
      position: fixed;
      inset: 0;
      background-image: url("{% static 'images/5678background.png' %}");
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
      opacity: .35;
      z-index: -1;
      pointer-events: none;
    }

    /* Navbar + Footer colors */
    .navbar, footer {
      background-color: #d76f54 !important;
    }
    .navbar .nav-link,
    .navbar .navbar-brand,
    .navbar-text {
      color: #fff !important;
    }
    .navbar .nav-link.active,
    .navbar .nav-link:hover {
      color: #fff !important;
      text-decoration: underline;
      text-underline-offset: 4px;
    }

    /* Footer fixed bottom */
    footer {
      position: fixed;
      bottom: 0;
      left: 0;
      width: 100%;
      color: #fff;
      text-align: center;
      padding: 0.75rem 0;
    }

    /* Login/Register buttons */
    .navbar .btn-outline-light {
      border-color: #fff;
      color: #fff;
    }
    .navbar .btn-outline-light:hover {
      background-color: #fff;
      color: #d76f54;
    }
    .navbar .btn-light {
      background-color: #fff;
      color: #d76f54;
    }
    .navbar .btn-light:hover {
      background-color: #f0f0f0;
      color: #d76f54;
    }
  </style>

  {% url 'home' as home_url %}
  {% url 'event_list' as event_list_url %}
  {% url 'contacts' as contacts_url %}
  {% url 'admin_clubs' as admin_clubs_url %}
  {% url 'list_dancers' as dancers_url %}
  {% url 'logout' as logout_url %}
  {% url 'login' as login_url %}
  {% url 'register' as register_url %}
  {% load i18n %}
  {% url 'pending_club_requests' as pending_clubs_url %}
  {% url 'club_dashboard' as club_dashboard_url %}

{% if not is_judge_user %}
<nav class="navbar navbar-expand-lg border-bottom">
  <div class="container">
    <a class="navbar-brand fw-bold" href="{{ home_url|default:'#' }}">
      5678 Dance Portal
    </a>

    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#mainNav"
            aria-controls="mainNav" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse" id="mainNav">
      <ul class="navbar-nav me-auto mb-2 mb-lg-0">
        {% if user.is_authenticated and user.is_staff %}
          <li class="nav-item">
            <a class="nav-link {% if request.path == home_url %}active{% endif %}" href="{{ home_url }}">{% trans "Home" %}</a>
          </li>
          <li class="nav-item">
            <a class="nav-link {% if request.path == event_list_url %}active{% endif %}" href="{{ event_list_url }}">{% trans "Events" %}</a>
          </li>

          {# --- Admin: Clubs dropdown (All Clubs -> club_dashboard, Pending -> pending_club_requests) --- #}
          <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle {% if request.path == club_dashboard_url %}active{% endif %}"
               href="#" id="clubsDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
              {% trans "Clubs" %}
              {% if clubs_pending_count and clubs_pending_count > 0 %}
                <span class="badge rounded-pill text-bg-danger ms-1">{{ clubs_pending_count }}</span>
              {% endif %}
            </a>
            <ul class="dropdown-menu" aria-labelledby="clubsDropdown">
              <li>
                <a class="dropdown-item" href="{{ club_dashboard_url }}">
                  {% trans "All Clubs" %}
                </a>
              </li>
              <li>
                <a class="dropdown-item d-flex align-items-center justify-content-between" href="{{ pending_clubs_url }}">
                  <span>{% trans "Pending" %}</span>
                  {% if clubs_pending_count and clubs_pending_count > 0 %}
                    <span class="badge text-bg-danger ms-2">{{ clubs_pending_count }}</span>
                  {% endif %}
                </a>
              </li>
            </ul>
          </li>

        {% elif user.is_authenticated %}
          <li class="nav-item">
            <a class="nav-link {% if request.path == home_url %}active{% endif %}" href="{{ club_dashboard_url }}">{% trans "Dashboard" %}</a>
          </li>
          <li class="nav-item">
            <a class="nav-link {% if request.path == event_list_url %}active{% endif %}" href="{{ event_list_url }}">{% trans "Events" %}</a>
          </li>
          <li class="nav-item">
            <a class="nav-link {% if request.path == dancers_url %}active{% endif %}" href="{{ dancers_url }}">{% trans "Dancers" %}</a>
          </li>
          <li class="nav-item">
            <a class="nav-link {% if request.path == contacts_url %}active{% endif %}" href="{{ contacts_url }}">{% trans "Contact" %}</a>
          </li>

          {# Club users: Awaiting Confirmation pill --- #}
          {% if user_club and not user_club_confirmed %}
            <li class="nav-item">
              <a class="nav-link" href="{{ club_dashboard_url }}" title="{% trans 'Your club is awaiting admin confirmation' %}">
                <span class="badge rounded-pill text-bg-warning">{% trans "Awaiting Confirmation" %}</span>
              </a>
            </li>
          {% endif %}

        {% else %}
          <li class="nav-item">
            <a class="nav-link {% if request.path == home_url %}active{% endif %}" href="{{ home_url }}">{% trans "Home" %}</a>
          </li>
          <li class="nav-item">
            <a class="nav-link {% if request.path == event_list_url %}active{% endif %}" href="{{ event_list_url }}">{% trans "Events" %}</a>
          </li>
          <li class="nav-item">
            <a class="nav-link {% if request.path == contacts_url %}active{% endif %}" href="{{ contacts_url }}">{% trans "Contact" %}</a>
          </li>
        {% endif %}
      </ul>

      <ul class="navbar-nav ms-auto align-items-lg-center">

        {# ---- Tap-friendly language buttons (POST to set_language) ---- #}
        <li class="nav-item d-flex align-items-center">
          {% get_current_language as LANGUAGE_CODE %}
          <div class="lang-switch d-flex align-items-center gap-2 me-3">
            {# EN button #}
            <form action="{% url 'set_language' %}" method="post" class="m-0">
              {% csrf_token %}
              <input type="hidden" name="next" value="{{ request.get_full_path }}">
              <input type="hidden" name="language" value="en">
              <button type="submit"
                      class="btn btn-sm rounded-pill {% if LANGUAGE_CODE == 'en' %}btn-light fw-semibold{% else %}btn-outline-light{% endif %}">
                English
              </button>
            </form>

            {# SR button #}
            <form action="{% url 'set_language' %}" method="post" class="m-0">
              {% csrf_token %}
              <input type="hidden" name="next" value="{{ request.get_full_path }}">
              <input type="hidden" name="language" value="sr">
              <button type="submit"
                      class="btn btn-sm rounded-pill {% if LANGUAGE_CODE == 'sr' %}btn-light fw-semibold{% else %}btn-outline-light{% endif %}">
                Srpski
              </button>
            </form>
          </div>
        </li>

        {% if user.is_authenticated %}
          <li class="nav-item">
            <span class="navbar-text me-2">
              {% trans "Hello," %} {{ user.representative_name|default:user.username }}
            </span>
          </li>
          {% if logout_url %}
            <li class="nav-item">
              <a class="btn btn-outline-light btn-sm" href="{{ logout_url }}">{% trans "Logout" %}</a>
            </li>
          {% endif %}
        {% else %}
          {% if login_url %}
            <li class="nav-item">
              <a class="btn btn-light btn-sm me-2" href="{{ login_url }}">{% trans "Login" %}</a>
            </li>
          {% endif %}
          {% if register_url %}
            <li class="nav-item">
              <a class="btn btn-outline-light btn-sm" href="{{ register_url }}">{% trans "Register" %}</a>
            </li>
          {% endif %}
        {% endif %}
      </ul>
    </div>
  </div>
</nav>
{% endif %}

  <!-- Flash messages -->
  <div class="container mt-3">
    {% if messages %}
      {% for message in messages %}
        {% with message.tags as tags %}
          <div class="alert {% if 'error' in tags %}alert-danger{% elif 'success' in tags %}alert-success{% elif 'warning' in tags %}alert-warning{% else %}alert-info{% endif %} alert-dismissible fade show" role="alert">
            {{ message }}
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
          </div>
        {% endwith %}
      {% endfor %}
    {% endif %}
  </div>

  <!-- Main content -->
  <main class="container py-3">
    {% block page_header %}{% endblock %}
    {% block content %}{% endblock %}
  </main>

  <!-- Fixed footer -->
  <footer>
    <div class="container">
      &copy; {% now "Y" %} 5678 Community
    </div>
  </footer>

  <!-- Bootstrap bundle -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
          integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
          crossorigin="anonymous"></script>

  <!-- Optional legacy scripts -->
  <script src="https://code.jquery.com/jquery-3.7.1.min.js" crossorigin="anonymous"></script>
  <script src="https://code.jquery.com/ui/1.13.3/jquery-ui.min.js" crossorigin="anonymous"></script>
  <script src="{% static 'core/js/Sortable.min.js' %}"></script>

  <!-- CSRF setup -->
  <script>
    (function() {
      function getCookie(name) {
        const value = `; ${document.cookie}`;
        const parts = value.split(`; ${name}=`);
        if (parts.length === 2) return parts.pop().split(';').shift();
      }
      const csrftoken = getCookie('csrftoken');
      if (window.jQuery) $.ajaxSetup({ headers: { 'X-CSRFToken': csrftoken } });
    })();
  </script>

  {% block extra_scripts %}{% endblock %}
</body>
</html>
