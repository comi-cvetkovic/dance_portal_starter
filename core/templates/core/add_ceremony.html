{% extends 'core/base.html' %}
{% load i18n %}
{% block title %}{% trans "Ceremonies" %} - {{ event.name }}{% endblock %}

{% block breadcrumbs %}
<nav aria-label="breadcrumb" class="mb-3">
  <ol class="breadcrumb mb-0">
    <li class="breadcrumb-item"><a href="{% url 'home' %}">{% trans "Home" %}</a></li>
    <li class="breadcrumb-item"><a href="{% url 'event_list' %}">{% trans "Events" %}</a></li>
    <li class="breadcrumb-item"><a href="{% url 'manage_start_list' event.id %}">{% trans "Manage Start List" %}</a></li>
    <li class="breadcrumb-item active" aria-current="page">
      {% if edit_mode %}{% trans "Edit Ceremony" %}{% else %}{% trans "Add Ceremony" %}{% endif %}
    </li>
  </ol>
</nav>
{% endblock %}

{% block content %}

<div class="d-flex justify-content-between align-items-center mb-3">
  <h2 class="mb-0">{% trans "Awards Ceremonies" %} - {{ event.name }}</h2>
</div>

<div class="row g-4">
  <div class="col-12 col-lg-6">
    <div class="dp-card h-100">
      <div class="card-header">
        <h3 class="mb-0">
          {% if edit_mode %}{% trans "Edit Ceremony" %}{% else %}{% trans "Add Ceremony" %}{% endif %}
        </h3>
      </div>
      <div class="card-body">
        {% if form.non_field_errors %}
          <div class="alert alert-danger mb-3">{{ form.non_field_errors }}</div>
        {% endif %}

        <form method="post" class="ceremony-form" novalidate>
          {% csrf_token %}

          <div class="mb-3">
            <label for="id_title" class="form-label fw-semibold">{% trans "Heading" %}</label>
            {{ form.title }}
            {% if form.title.errors %}
              <div class="text-danger small mt-1">{{ form.title.errors|join:", " }}</div>
            {% endif %}
          </div>

          <div class="mb-3">
            <label for="id_duration_minutes" class="form-label fw-semibold">{% trans "Duration (minutes)" %}</label>
            {{ form.duration_minutes }}
            {% if form.duration_minutes.errors %}
              <div class="text-danger small mt-1">{{ form.duration_minutes.errors|join:", " }}</div>
            {% endif %}
          </div>

          <div class="mb-3">
            <label for="id_age_group" class="form-label fw-semibold">{% trans "Age Group (optional)" %}</label>
            {{ form.age_group }}
            {% if form.age_group.errors %}
              <div class="text-danger small mt-1">{{ form.age_group.errors|join:", " }}</div>
            {% endif %}
          </div>

          <div class="d-flex gap-2">
            <button type="submit" class="btn btn-coral">
              {% if edit_mode %}{% trans "Save Ceremony" %}{% else %}{% trans "Add Ceremony" %}{% endif %}
            </button>
            <a href="{% url 'manage_start_list' event.id %}" class="btn btn-outline-secondary">
              {% trans "Cancel" %}
            </a>
          </div>
        </form>
      </div>
    </div>
  </div>

  <div class="col-12 col-lg-6">
    <div class="dp-card h-100">
      <div class="card-header">
        <h3 class="mb-0">{% trans "Existing Ceremonies" %}</h3>
      </div>
      <div class="card-body">
        {% if ceremonies %}
          <ul class="list-group list-group-flush rounded-3 overflow-hidden">
            {% for ceremony in ceremonies %}
              <li class="list-group-item d-flex flex-wrap justify-content-between align-items-center gap-2">
                <div class="d-flex flex-column">
                  <span class="fw-semibold">{{ ceremony.title }}</span>
                  <div class="d-flex flex-wrap gap-2 mt-1">
                    {% if ceremony.age_group %}
                      <span class="badge rounded-pill text-bg-secondary">{{ ceremony.age_group }}</span>
                    {% endif %}
                    <span class="badge rounded-pill text-bg-light border">
                      {{ ceremony.duration_minutes }} {% trans "min" %}
                    </span>
                  </div>
                </div>

                <div class="d-flex gap-2">
                  <a href="{% url 'edit_ceremony' ceremony.id %}" class="btn btn-coral-outline btn-sm">
                    {% trans "Edit" %}
                  </a>
                  <form method="post" action="{% url 'delete_ceremony' ceremony.id %}">
                    {% csrf_token %}
                    <button type="submit" class="btn btn-outline-danger btn-sm"
                            onclick="return confirm('Delete this ceremony?');">
                      {% trans "Delete" %}
                    </button>
                  </form>
                </div>
              </li>
            {% endfor %}
          </ul>
        {% else %}
          <div class="alert alert-light border mb-0">
            {% trans "No ceremonies added yet." %}
          </div>
        {% endif %}
      </div>
    </div>
  </div>
</div>

{% endblock %}

{% block extra_head %}
<style>
  .dp-card{
    background:#fff;
    border:1px solid #eee;
    border-radius:14px;
    box-shadow:0 2px 10px rgba(0,0,0,.05);
    overflow:hidden;
  }
  .dp-card .card-header{
    background:#fafafa;
    border-bottom:1px solid #eee;
    padding:.8rem 1rem;
  }

  .ceremony-form input[type="text"],
  .ceremony-form input[type="number"],
  .ceremony-form select{
    display:block;
    width:100%;
    max-width: 520px;
    height:44px;
    padding:.6rem .8rem;
    border:1px solid #e1d5d1;
    border-radius:10px;
    background:#fff;
    color:#2b2b2b;
    box-shadow: inset 0 1px 2px rgba(0,0,0,.04);
    box-sizing:border-box;
  }
  .ceremony-form input:focus,
  .ceremony-form select:focus{
    outline:none;
    border-color:#d76f54;
    box-shadow:0 0 0 3px rgba(215,111,84,.15);
  }

  .list-group-item{ padding:.85rem 1rem; }
</style>
{% endblock %}
