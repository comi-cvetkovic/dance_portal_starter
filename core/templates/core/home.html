{% extends 'core/base.html' %}
{% load i18n static %}
{% block title %}{% trans "Home | Dance Portal" %}{% endblock %}

{% block extra_head %}{% endblock %}

{% block content %}
<div class="container-lg home-wrap">

  <!-- HERO -->
  <div class="hero text-center mb-4">
    <h1 class="mb-1">{% trans "Welcome to the 5678 Dance Portal" %}</h1>
    <p class="subtitle mb-4">
      {% trans "Your all-in-one platform to manage dancers, clubs, and competitions." %}
    </p>

    {% if user.is_authenticated %}
      {% if user.is_superuser %}
        <a href="{% url 'event_list' %}" class="btn btn-coral btn-pill me-2">
          <i class="bi bi-calendar-event me-2"></i>{% trans "Manage Events" %}
        </a>
      {% else %}
        <a href="{% url 'list_dancers' %}" class="btn btn-coral btn-pill me-2">
          <i class="bi bi-people me-2"></i>{% trans "View My Dancers" %}
        </a>
      {% endif %}
    {% else %}
      <div class="home-cta-group d-flex justify-content-center flex-wrap gap-2">
        <a href="{% url 'login' %}" class="btn btn-coral btn-pill home-cta">
          <i class="bi bi-box-arrow-in-right me-2"></i>{% trans "Login" %}
        </a>
        <a href="{% url 'register_club' %}" class="btn btn-coral btn-pill home-cta">
          <i class="bi bi-plus-circle me-2"></i>{% trans "Register Your Club" %}
        </a>
      </div>
    {% endif %}
  </div>

  <!-- WHAT YOU CAN DO -->
  <div class="text-center mb-4">
    <h3 class="section-title">{% trans "What you can do" %}</h3>
  </div>

  <div class="row g-4">
    <div class="col-12 col-md-4">
      <div class="feature-card h-100 text-center">
        <div class="icon-bubble"><i class="bi bi-calendar-check"></i></div>
        <h5>{% trans "View Upcoming Events" %}</h5>
        <p class="small mb-3">
          {% trans "See all registered competitions and their start lists in one place." %}
        </p>
        <a href="{% url 'event_list' %}" class="stretched-link"></a>
      </div>
    </div>


    {% if user.is_superuser %}
    <div class="col-12 col-md-4">
      <div class="feature-card h-100 text-center">
        <div class="icon-bubble"><i class="bi bi-person-badge"></i></div>
        <h5>{% trans "Manage Clubs" %}</h5>
        <p class="small mb-3">
          {% trans "Add, approve, delete or edit existing clubs" %}
        </p>
        <a href="{% url 'club_dashboard' %}" class="stretched-link"></a>
      </div>
    </div>
    {% else %}
    <div class="col-12 col-md-4">
      <div class="feature-card h-100 text-center">
        <div class="icon-bubble"><i class="bi bi-person-badge"></i></div>
        <h5>{% trans "Manage Your Dancers" %}</h5>
        <p class="small mb-3">
          {% trans "Add, edit, and organize all dancers linked to your club profile." %}
        </p>
        <a href="{% url 'list_dancers' %}" class="stretched-link"></a>
      </div>
    </div>
    {% endif %}
    <div class="col-12 col-md-4">
      <div class="feature-card h-100 text-center">
        <div class="icon-bubble"><i class="bi bi-music-note-beamed"></i></div>
        <h5>{% trans "Upload Performance Music" %}</h5>
        <p class="small mb-3">
          {% trans "Easily upload and manage music files for each choreography entry." %}
        </p>
        {% if user.is_authenticated %}
          <a href="#" class="stretched-link" data-bs-toggle="modal" data-bs-target="#chooseEventModal"></a>
        {% else %}
          <a href="{% url 'login' %}" class="stretched-link"></a>
        {% endif %}
      </div>
    </div>
  </div>

  <!-- UPCOMING EVENTS (read-only) -->
  <div class="text-center mt-5 mb-4">
    <h3 class="section-title">{% trans "Upcoming Events" %}</h3>
  </div>

  {% if upcoming_events %}
    <div class="row g-4">
      {% for ev in upcoming_events %}
        <div class="col-12 col-sm-6 col-lg-3">
          <div class="event-card">
            {% if ev.notice_image %}
              <img class="event-poster" src="{{ ev.notice_image.url }}" alt="{{ ev.name }}">
            {% else %}
              <img class="event-poster" src="{% static 'images/background.jpg' %}" alt="{{ ev.name }}">
            {% endif %}
            <div class="event-meta">
              <p class="event-title">{{ ev.name }}</p>
              <p class="event-sub">{{ ev.city }} &middot; {{ ev.date }}</p>
            </div>
          </div>
        </div>
      {% endfor %}
    </div>
  {% else %}
    <div class="alert alert-light border mb-0">
      {% trans "No upcoming events yet." %}
    </div>
  {% endif %}
</div>

{% if user.is_authenticated %}
<div class="modal fade" id="chooseEventModal" tabindex="-1" aria-labelledby="chooseEventModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="chooseEventModalLabel">{% trans "Choose an event" %}</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="{% trans 'Close' %}"></button>
      </div>
      <div class="modal-body">
        {% if event_choices %}
          <div class="list-group">
            {% for ev in event_choices %}
              <a class="list-group-item list-group-item-action d-flex justify-content-between align-items-center"
                 href="{% url 'list_event_participants' ev.id %}">
                <span class="fw-semibold">{{ ev.name }}</span>
                <span class="text-muted small">{{ ev.city }} &middot; {{ ev.date }}</span>
              </a>
            {% endfor %}
          </div>
        {% else %}
          <p class="mb-2">{% trans "No events found." %}</p>
          <a class="btn btn-coral-outline btn-sm" href="{% url 'event_list' %}">{% trans "Go to events" %}</a>
        {% endif %}
      </div>
    </div>
  </div>
</div>
{% endif %}
{% endblock %}



