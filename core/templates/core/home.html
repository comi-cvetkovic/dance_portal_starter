{% extends 'core/base.html' %}
{% load i18n static %}
{% block title %}{% trans "Home | Dance Portal" %}{% endblock %}

{% block extra_head %}
<style>
  :root { --coral:#d76f54; --ink:#2b2b2b; }

  /* --- HERO --- */
  .hero h1 {
    color: var(--ink);
    font-weight: 800;
    letter-spacing: .2px;
    margin-bottom: .35rem;
  }
  .hero .subtitle {
    color: #6b6b6b;
    font-size: 1.05rem;
  }

  /* coral underline accent under “What you can do” */
  .section-title {
    position: relative;
    display: inline-block;
    color: var(--ink);
    font-weight: 700;
  }
  .section-title::after{
    content:"";
    position:absolute; left:50%; transform:translateX(-50%);
    bottom:-10px; width:120px; height:4px;
    background: var(--coral);
    border-radius: 999px;
    box-shadow: 0 1px 0 rgba(0,0,0,.05);
  }

  /* --- FEATURE CARDS --- */
  .feature-card {
    position: relative;
    background:#fff2ee;
    border:1px solid #eee;
    border-radius:16px;
    padding:1.35rem 1.2rem;
    box-shadow: 0 8px 18px rgba(0,0,0,.06);
    transition: transform .2s ease, box-shadow .2s ease, border-color .2s ease;
    height: 100%;
  }
  .feature-card:hover{
    transform: translateY(-6px);
    box-shadow: 0 16px 28px rgba(0,0,0,.1);
    border-color:#f0c2b7;
  }

  /* Icon bubble */
  .icon-bubble{
    width:48px; height:48px;
    border-radius:50%;
    display:flex; align-items:center; justify-content:center;
    background: rgba(215,111,84,.12);
    color: var(--coral);
    font-size:1.35rem;
    margin: 0 auto .75rem;
  }

  .feature-card h5{
    color: var(--ink);
    font-weight: 700;
    margin-bottom: .35rem;
  }
  .feature-card p{ color:#6f6f6f; }

  /* Make the whole card clickable nicely */
  .feature-card .stretched-link{ position: static; } /* allow normal padding click */

  /* --- BUTTONS --- */
  .btn-coral{ background-color:var(--coral); border-color:var(--coral); color:#fff; }
  .btn-coral:hover{ background-color:#c45f45; border-color:#c45f45; color:#fff; }
  .btn-pill{ border-radius: 999px; padding:.6rem 1.15rem; font-weight:600; }

  /* spacing fix for the heavy background */
  .home-wrap{ margin-top: 2rem; margin-bottom: 2.5rem; }

  @media (max-width: 768px){
    .hero{ padding:1.6rem 1rem; }
    .section-title::after{ width:90px; }
  }

  /* --- UPCOMING EVENTS --- */
  .event-card {
    background: #fff;
    border: 1px solid #eee;
    border-radius: 16px;
    overflow: hidden;
    box-shadow: 0 10px 22px rgba(0,0,0,.08);
    height: 100%;
  }
  .event-poster {
    width: 100%;
    aspect-ratio: 3 / 4;
    object-fit: cover;
    background: #fff2ee;
    display: block;
  }
  .event-meta {
    padding: .9rem 1rem 1rem;
  }
  .event-title {
    font-weight: 800;
    margin: 0 0 .25rem;
    color: var(--ink);
  }
  .event-sub {
    margin: 0;
    color: #6b6b6b;
    font-size: .9rem;
  }
</style>
{% endblock %}

{% block content %}
<div class="container-lg home-wrap">

  <!-- HERO -->
  <div class="hero text-center mb-4">
    <h1 class="mb-1">{% trans "Welcome to the 5678 Dance Portal" %}</h1>
    <p class="subtitle mb-4">
      {% trans "Your all-in-one platform to manage dancers, clubs, and competitions." %}
    </p>

    {% if user.is_authenticated %}
      {% if user.is_superuser %}
        <a href="{% url 'event_list' %}" class="btn btn-coral btn-pill me-2">
          <i class="bi bi-calendar-event me-2"></i>{% trans "Manage Events" %}
        </a>
      {% else %}
        <a href="{% url 'list_dancers' %}" class="btn btn-coral btn-pill me-2">
          <i class="bi bi-people me-2"></i>{% trans "View My Dancers" %}
        </a>
      {% endif %}
    {% else %}
      <a href="{% url 'login' %}" class="btn btn-coral btn-pill me-2">
        <i class="bi bi-box-arrow-in-right me-2"></i>{% trans "Login" %}
      </a>
      <a href="{% url 'register_club' %}" class="btn btn-coral btn-pill">
        <i class="bi bi-plus-circle me-2"></i>{% trans "Register Your Club" %}
      </a>
    {% endif %}
  </div>

  <!-- WHAT YOU CAN DO -->
  <div class="text-center mb-4">
    <h3 class="section-title">{% trans "What you can do" %}</h3>
  </div>

  <div class="row g-4">
    <div class="col-12 col-md-4">
      <div class="feature-card h-100 text-center">
        <div class="icon-bubble"><i class="bi bi-calendar-check"></i></div>
        <h5>{% trans "View Upcoming Events" %}</h5>
        <p class="small mb-3">
          {% trans "See all registered competitions and their start lists in one place." %}
        </p>
        <a href="{% url 'event_list' %}" class="stretched-link"></a>
      </div>
    </div>


    {% if user.is_superuser %}
    <div class="col-12 col-md-4">
      <div class="feature-card h-100 text-center">
        <div class="icon-bubble"><i class="bi bi-person-badge"></i></div>
        <h5>{% trans "Manage Clubs" %}</h5>
        <p class="small mb-3">
          {% trans "Add, approve, delete or edit existing clubs" %}
        </p>
        <a href="{% url 'club_dashboard' %}" class="stretched-link"></a>
      </div>
    </div>
    {% else %}
    <div class="col-12 col-md-4">
      <div class="feature-card h-100 text-center">
        <div class="icon-bubble"><i class="bi bi-person-badge"></i></div>
        <h5>{% trans "Manage Your Dancers" %}</h5>
        <p class="small mb-3">
          {% trans "Add, edit, and organize all dancers linked to your club profile." %}
        </p>
        <a href="{% url 'list_dancers' %}" class="stretched-link"></a>
      </div>
    </div>
    {% endif %}
    <div class="col-12 col-md-4">
      <div class="feature-card h-100 text-center">
        <div class="icon-bubble"><i class="bi bi-music-note-beamed"></i></div>
        <h5>{% trans "Upload Performance Music" %}</h5>
        <p class="small mb-3">
          {% trans "Easily upload and manage music files for each choreography entry." %}
        </p>
        {% if user.is_authenticated %}
          <a href="#" class="stretched-link" data-bs-toggle="modal" data-bs-target="#chooseEventModal"></a>
        {% else %}
          <a href="{% url 'login' %}" class="stretched-link"></a>
        {% endif %}
      </div>
    </div>
  </div>

  <!-- UPCOMING EVENTS (read-only) -->
  <div class="text-center mt-5 mb-4">
    <h3 class="section-title">{% trans "Upcoming Events" %}</h3>
  </div>

  {% if upcoming_events %}
    <div class="row g-4">
      {% for ev in upcoming_events %}
        <div class="col-12 col-sm-6 col-lg-3">
          <div class="event-card">
            {% if ev.notice_image %}
              <img class="event-poster" src="{{ ev.notice_image.url }}" alt="{{ ev.name }}">
            {% else %}
              <img class="event-poster" src="{% static 'images/background.jpg' %}" alt="{{ ev.name }}">
            {% endif %}
            <div class="event-meta">
              <p class="event-title">{{ ev.name }}</p>
              <p class="event-sub">{{ ev.city }} · {{ ev.date }}</p>
            </div>
          </div>
        </div>
      {% endfor %}
    </div>
  {% else %}
    <div class="alert alert-light border mb-0">
      {% trans "No upcoming events yet." %}
    </div>
  {% endif %}
</div>

{% if user.is_authenticated %}
<div class="modal fade" id="chooseEventModal" tabindex="-1" aria-labelledby="chooseEventModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="chooseEventModalLabel">{% trans "Choose an event" %}</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="{% trans 'Close' %}"></button>
      </div>
      <div class="modal-body">
        {% if event_choices %}
          <div class="list-group">
            {% for ev in event_choices %}
              <a class="list-group-item list-group-item-action d-flex justify-content-between align-items-center"
                 href="{% url 'list_event_participants' ev.id %}">
                <span class="fw-semibold">{{ ev.name }}</span>
                <span class="text-muted small">{{ ev.city }} · {{ ev.date }}</span>
              </a>
            {% endfor %}
          </div>
        {% else %}
          <p class="mb-2">{% trans "No events found." %}</p>
          <a class="btn btn-coral-outline btn-sm" href="{% url 'event_list' %}">{% trans "Go to events" %}</a>
        {% endif %}
      </div>
    </div>
  </div>
</div>
{% endif %}
{% endblock %}



