{% extends 'core/base.html' %}
{% load i18n %}
{% block title %}{% trans "Diplomas" %} â€“ {{ event.name }}{% endblock %}

{% block content %}

<!-- Header + toolbar -->
<div class="d-flex justify-content-between align-items-center mb-3">
  <h2 class="mb-0">{% trans "Diplomas for" %} {{ event.name }}</h2>
  <div class="d-flex gap-2">
  <!-- Breadcrumbs handle navigation -->
    <button type="button" onclick="window.print()" class="btn btn-coral">
      ðŸ–¨ {% trans "Print All" %}
    </button>
  </div>
</div>

{% if diplomas %}
  <!-- Screen grid -->
  <div class="diploma-grid">
    {% for diploma in diplomas %}
      <div class="dp-card diploma-card">
        <div class="card-body p-2">
          <img
            src="{{ diploma.image.url }}"
            alt="Diploma for {{ diploma.dancer|default:'-' }}"
            class="diploma-img"
          >
        </div>
      </div>
    {% endfor %}
  </div>
{% else %}
  <div class="alert alert-light border mb-0">
    {% trans "No diplomas have been generated yet." %}
  </div>
{% endif %}

{% endblock %}

{% block extra_head %}
<style>
  /* ---- Card + grid for screen ---- */
  .dp-card{
    background:#fff; border:1px solid #eee; border-radius:14px;
    box-shadow:0 2px 10px rgba(0,0,0,.05); overflow:hidden;
  }
  .diploma-grid{
    display:grid;
    grid-template-columns: repeat(auto-fill, minmax(340px, 1fr));
    gap:1rem;
  }
  .diploma-card .card-body{
    padding: .75rem;
  }
  .diploma-img{
    display:block;
    width:100%;
    height:auto;
    border:1px solid #ddd;
    border-radius:8px;
  }

  /* ---- Print layout: one diploma per page, edge-to-edge ---- */
  @media print {
    @page { size: auto; margin: 0; }

    /* Hide everything except the diplomas themselves */
    body * { visibility: hidden; }
    .diploma-print-wrap, .diploma-print-wrap * { visibility: visible; }

    /* Replace grid with full-page, one-per-page flow */
    .diploma-grid{
      display:block !important;
    }
    .diploma-card{
      page-break-after: always !important;
      border: none !important;
      box-shadow: none !important;
      margin: 0 !important;
      padding: 0 !important;
    }
    .diploma-card .card-body{
      padding: 0 !important;
    }
    .diploma-img{
      border: none !important;
      border-radius: 0 !important;
      width: 100vw !important;
      height: auto !important;
      max-width: 100vw !important;
    }

    /* Hide UI elements on print */
    h1, h2, h3, .btn, a, .navbar, .footer, .alert { display:none !important; }
  }
</style>

<script>
  // Wrap diplomas for the print visibility rule
  document.addEventListener('DOMContentLoaded', function(){
    const grid = document.querySelector('.diploma-grid');
    if (grid && !grid.classList.contains('diploma-print-wrap')) {
      grid.classList.add('diploma-print-wrap');
    }
  });
</script>
{% endblock %}
