{% extends 'core/base.html' %}
{% load i18n %}
{% block title %}{% trans "Results " %}â€“ {{ event.name }}{% endblock %}

{% block content %}

<!-- Header + back -->
<div class="d-flex justify-content-between align-items-center mb-3">
  <div>
    <h2 class="mb-1">{% trans "Results" %} â€” {{ event.name }} ({{ event.date }})</h2>
    <div class="d-flex flex-wrap gap-2 mt-2">
      <span class="badge rounded-pill text-bg-light border">{{ category.0 }}</span>
      <span class="badge rounded-pill text-bg-light border">{{ category.1 }}</span>
      <span class="badge rounded-pill text-bg-light border">{{ category.2 }}</span>
      <span class="badge rounded-pill text-bg-light border">{{ category.3 }}</span>
    </div>
  </div>

  <!-- Breadcrumbs handle navigation -->
</div>

<div class="dp-card">
  <div class="card-body">
    <div class="table-responsive">
      <table class="table table-striped align-middle results-table">
        <thead class="table-light">
          <tr>
            <th style="width:90px;">{% trans "Position" %}</th>
            <th style="min-width:240px;">{% trans "Dancer(s)" %}</th>
            <th style="min-width:200px;">{% trans "Choreography" %}</th>
            <th style="min-width:160px;">{% trans "Club" %}</th>
            <th style="min-width:260px;">{% trans "Judge Scores" %}</th>
            <th class="text-end" style="width:110px;">{% trans "Avg" %}</th>
          </tr>
        </thead>
        <tbody>
          {% for entry in results %}
          <tr class="{% if forloop.counter == 1 %}place-gold{% elif forloop.counter == 2 %}place-silver{% elif forloop.counter == 3 %}place-bronze{% endif %}">
            <td class="fw-semibold">
              {% if forloop.counter == 1 %}ðŸ¥‡{% elif forloop.counter == 2 %}ðŸ¥ˆ{% elif forloop.counter == 3 %}ðŸ¥‰{% endif %}
              {{ forloop.counter }}
            </td>

            <td class="text-wrap">
              {% if entry.participation.group_name and entry.dancers|length >= 4 %}
                {{ entry.participation.group_name }}
              {% else %}
                {% for d in entry.dancers %}
                  {{ d.first_name }} {{ d.last_name }}{% if not forloop.last %}, {% endif %}
                {% endfor %}
              {% endif %}
            </td>

            <td class="text-wrap">{{ entry.participation.choreography_name }}</td>

            <td class="text-wrap">
              {% if entry.dancers %}
                {{ entry.dancers.0.club.club_name }}
              {% else %}
                <span class="badge rounded-pill text-bg-secondary">{% trans "Unknown" %}</span>
              {% endif %}
            </td>

            <td>
              {% if entry.scores %}
                <ul class="list-unstyled mb-0 small">
                  {% for s in entry.scores %}
                    <li class="mb-1">
                      <span class="fw-semibold">{{ s.judge.first_name }} {{ s.judge.last_name }}</span>:
                      <span class="score-chip">T={{ s.technicality }}</span>
                      <span class="score-chip">C={{ s.creativity }}</span>
                      <span class="score-chip">S={{ s.synchronization }}</span>
                      <span class="score-chip">O={{ s.overall }}</span>
                    </li>
                  {% endfor %}
                </ul>
              {% else %}
                <span class="text-muted">â€”</span>
              {% endif %}
            </td>

            <td class="text-end fw-bold">{{ entry.average }}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</div>

{% endblock %}

{% block extra_head %}
<style>
  /* Card shell to match site look */
  .dp-card{
    background:#fff;
    border:1px solid #eee;
    border-radius:14px;
    box-shadow:0 2px 10px rgba(0,0,0,.05);
    overflow:hidden;
  }
  .dp-card .card-body{ padding:1.25rem 1.25rem; }

  /* Table spacing & wrapping */
  .results-table th, .results-table td{ padding:.75rem 1rem; vertical-align:middle; }
  .results-table td.text-wrap{ white-space:normal; word-break:break-word; }

  /* Medal row tints (subtle) */
  .place-gold   { background:#fff9e6; }
  .place-silver { background:#f7f7f9; }
  .place-bronze { background:#fff2e6; }

  /* Judge score mini chips */
  .score-chip{
    display:inline-block;
    border:1px solid #e6e6e6;
    border-radius:999px;
    padding:.1rem .45rem;
    margin-right:.25rem;
    background:#fff;
  }
</style>
{% endblock %}
