{% extends 'core/base.html' %}
{% load i18n %}
{% block title %}{% trans "Awards" %} â€“ {{ event.name }}{% endblock %}

{% block content %}
<h2>{% trans "Awards" %} â€“ {{ event.name }} ({{ event.date }})</h2>

{% if user.is_superuser %}
  <form method="post" action="{% url 'publish_awards' event.id %}" style="margin-top:1em; margin-bottom:2em;">
    {% csrf_token %}
    {% if event.results_published %}
      <button type="submit" class="btn btn-delete">{% trans "Unpublish Awards" %}</button>
    {% else %}
      <button type="submit" class="btn btn-green">{% trans "Publish Awards" %}</button>
    {% endif %}
  </form>
{% endif %}

{% if grouped_results %}
  {% for group_key, results in grouped_results.items %}
    <div class="award-category" style="margin-bottom:2.5em;">
      <h3 class="category-title">
        {{ group_key.0 }} â€“ {{ group_key.1 }} â€“ {{ group_key.2 }} â€“ {{ group_key.3 }}
      </h3>

      {% if results %}
        <table class="award-table">
          <thead>
            <tr>
              <th>{% trans "Position" %}</th>
              <th>{% trans "Dancer(s) / Group" %}</th>
              <th>{% trans "Choreography" %}</th>
              <th>{% trans "Club" %}</th>
              <th>{% trans "Final Score" %}</th>
              <th></th>
            </tr>
          </thead>
          <tbody>
            {% for item in results %}
            <tr class="placement-row
              {% if forloop.counter == 1 %} first-place
              {% elif forloop.counter == 2 %} second-place
              {% elif forloop.counter == 3 %} third-place
              {% endif %}">
              <td class="placement">
                {% if forloop.counter == 1 %}ðŸ¥‡{% elif forloop.counter == 2 %}ðŸ¥ˆ{% elif forloop.counter == 3 %}ðŸ¥‰{% endif %}
                {{ forloop.counter }}
              </td>
              <td>
                {% if item.participation.group_name %}
                  {{ item.participation.group_name }}
                {% else %}
                  {% for d in item.dancers %}
                    {{ d.first_name }} {{ d.last_name }}{% if not forloop.last %}, {% endif %}
                  {% endfor %}
                {% endif %}
              </td>
              <td>{{ item.participation.choreography_name }}</td>
              <td>
                {% if item.dancers %}
                  {{ item.dancers.0.club.club_name }}
                {% else %}
                  â€“
                {% endif %}
              </td>
              <td><strong>{{ item.score }}</strong></td>
              <td>
                <a href="{% url 'participation_scores' item.participation.id %}?group={{ forloop.parentloop.counter0 }}"
                   class="btn btn-default btn-sm">
                  {% trans "View Detailed Scores" %}
                </a>
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>

        {% if user.is_superuser %}
          <form method="post" action="{% url 'generate_diploma' event.id %}" style="margin-top:1em;">
            {% csrf_token %}
            <input type="hidden" name="category" value="{{ group_key.0 }}|{{ group_key.1 }}|{{ group_key.2 }}|{{ group_key.3 }}">
            <button type="submit" class="btn btn-green">
              ðŸ–¨ {% trans "Preview & Print Diplomas for this Category" %}
            </button>
          </form>
        {% endif %}

      {% else %}
        <p><em>{% trans "No results for this category yet." %}</em></p>
      {% endif %}
    </div>
  {% endfor %}
{% else %}
  <p>{% trans "No results available." %}</p>
{% endif %}
{% endblock %}

{% block extra_styles %}
<style>
  .award-table {
    width: 100%;
    border-collapse: collapse;
    table-layout: fixed;
  }

  .award-table th,
  .award-table td {
    padding: 10px 12px;
    border-bottom: 1px solid #ddd;
    vertical-align: middle;
    text-align: left;
  }

  .award-table th:nth-child(1),
  .award-table td:nth-child(1) { width: 8%; text-align: center; }
  .award-table th:nth-child(2),
  .award-table td:nth-child(2) { width: 30%; }
  .award-table th:nth-child(3),
  .award-table td:nth-child(3) { width: 25%; }
  .award-table th:nth-child(4),
  .award-table td:nth-child(4) { width: 20%; }
  .award-table th:nth-child(5),
  .award-table td:nth-child(5) { width: 10%; text-align: right; }
  .award-table th:nth-child(6),
  .award-table td:nth-child(6) { width: 12%; text-align: right; }

  .award-table thead th {
    background: #f8f9fa;
    font-weight: 600;
  }

  .placement-row.first-place { background: #fff8dc; }
  .placement-row.second-place { background: #f8f8f8; }
  .placement-row.third-place { background: #ffe4c4; }

  .placement { font-weight: bold; text-align: center; }
</style>
{% endblock %}
